<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2468 Game Online - Free Number Puzzle Games</title>
    <meta name="description" content="Play the best 2468 and 2048 number puzzle games online for free. Challenge your brain with smooth gameplay!">
    <meta name="keywords" content="2468, 2048, number puzzle, free online games, puzzle, brain game, logic, online, play">
    <link rel="canonical" href="https://www.2468game.online/">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Open Graph -->
    <meta property="og:title" content="2468 Game Online - Free Number Puzzle Games">
    <meta property="og:description" content="Play the best 2468 and 2048 number puzzle games online for free. Challenge your brain with smooth gameplay!">
    <meta property="og:url" content="https://www.2468game.online/">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://www.2468game.online/og-image.svg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/svg+xml">
    <meta property="og:site_name" content="2468 Game Online">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@2468game">
    <meta name="twitter:title" content="2468 Game Online - Free Number Puzzle Games">
    <meta name="twitter:description" content="Play the best 2468 and 2048 number puzzle games online for free. Challenge your brain with smooth gameplay!">
    <meta name="twitter:image" content="https://www.2468game.online/og-image.svg">
    
    <!-- Additional SEO -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="baiduspider" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="yandexbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="duckduckbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="facebookexternalhit" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="twitterbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="linkedinbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="whatsapp" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="telegrambot" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="microMessenger" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    
    <!-- 防爬虫保护 -->
    <meta name="crawler-protection" content="enabled">
    <meta name="anti-bot" content="active">
    <meta name="rate-limit" content="100/hour">
    <meta name="access-control" content="human-only">
    
    <!-- 安全策略 -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="no-referrer">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    
    <!-- 防止缓存 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D1EDWD1K0M"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-D1EDWD1K0M');
    </script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "2468 Game Online",
      "url": "https://www.2468game.online/",
      "description": "Play the best 2468 and 2048 number puzzle games online for free. Challenge your brain with smooth gameplay!",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://www.2468game.online/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Game",
      "name": "2468 Game Online",
      "description": "Play the best 2468 and 2048 number puzzle games online for free. Challenge your brain with smooth gameplay!",
      "url": "https://www.2468game.online/",
      "gamePlatform": "Web Browser",
      "applicationCategory": "Game",
      "genre": "Puzzle",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #faf8f0;
        }
        .main-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin-top: 2rem;
            margin-bottom: 0.5rem;
            color: #22223b;
        }
        .main-desc {
            text-align: center;
            font-size: 1.2rem;
            color: #4a4e69;
            margin-bottom: 1.5rem;
        }
        .game-fullscreen {
            width: 100vw;
            height: calc(100vh - 120px);
            border: none;
            display: block;
            margin: 0 auto;
            background: #faf8f0;
        }
        @media (max-width: 600px) {
            .main-title { font-size: 1.5rem; }
            .main-desc { font-size: 1rem; }
            .game-fullscreen { height: calc(100vh - 90px); }
        }
        :root {
            --apple-blue: #007AFF;
            --apple-gray: #8E8E93;
            --apple-light-gray: #F2F2F7;
            --apple-dark: #1C1C1E;
            --apple-green: #34C759;
            --apple-orange: #FF9500;
            --apple-purple: #AF52DE;
        }
        
        .apple-gradient {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
        }
        
        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 122, 255, 0.2);
        }
        
        /* 游戏iframe样式 */
        .game-fullscreen {
            width: 100%;
            height: 100vh;
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        body {
            margin: 0;
            background: #faf8f0;
        }
        .navbar {
            width: auto;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            background: #faf8f0;
            padding-top: 2.2rem;
            padding-left: 3.5rem;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }
        .navbar-inner {
            display: flex;
            align-items: center;
            background: transparent !important;
            border-radius: 20px;
            padding: 0.2em 1.7em 0.2em 1.2em;
            position: relative;
            box-shadow: none !important;
            transition: background 0.2s, box-shadow 0.2s;
        }
        .navbar-inner:hover {
            background: #d6cfc2 !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
        }
        .menu-icon {
            font-size: 2.2rem;
            margin-right: 0.7rem;
            color: #8d8374;
            font-weight: bold;
            user-select: none;
        }
        .navbar-title {
            font-size: 3rem;
            font-weight: bold;
            color: #7a6a58;
            letter-spacing: 0.5px;
            line-height: 1;
            text-decoration: none;
        }
        .dropdown-menu {
            display: none;
            flex-direction: column;
            position: absolute;
            top: 3.5rem;
            left: 0;
            background: #f5f1ea;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            min-width: 160px;
            padding: 0.7em 0;
            z-index: 100;
        }
        .dropdown-menu a {
            color: #7a6a58;
            text-decoration: none;
            padding: 0.7em 1.5em;
            font-size: 1.1rem;
            font-weight: 500;
            transition: background 0.2s;
            border-radius: 8px;
        }
        .dropdown-menu a:hover {
            background: #e0d7c6;
        }
        .dropdown-menu.show {
            display: flex;
        }
        @media (max-width: 600px) {
            .navbar { padding-top: 1rem; padding-left: 0.5rem; }
            .navbar-inner { padding: 0.1em 0.9em 0.1em 0.5em; }
            .navbar-title { font-size: 1.7rem; }
            .menu-icon { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-inner">
      <a href="index.html" style="text-decoration:none;display:flex;align-items:center;">
        <span class="menu-icon" id="menuIcon">&#9776;</span>
        <span class="navbar-title">24682048</span>
      </a>
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="how-to-play.html">How to Play</a>
        <a href="faq.html">FAQ</a>
        <a href="about.html">About Us</a>
        <a href="data.html">Statistics</a>
      </div>
    </div>
  </nav>
  
  <!-- SEO H1 Tag -->
  <h1 style="position: absolute; left: -9999px; top: -9999px;">2468 Game Online - Free Number Puzzle Games</h1>
    <!-- 本地2048游戏 -->
    <div id="game-container" class="game-fullscreen">
        <div class="game-header">
            <div class="score-container">
                <div class="score-box">
                    <span class="score-label">SCORE</span>
                    <span id="score">0</span>
                </div>
                <div class="score-box">
                    <span class="score-label">BEST</span>
                    <span id="best-score">0</span>
                </div>
            </div>
            <div class="game-controls">
                <select id="game-mode-selector" class="game-mode-selector">
                    <option value="classic">Classic 2048</option>
                    <option value="3x3">3x3 Grid</option>
                    <option value="5x5">5x5 Grid</option>
                    <option value="fibonacci">Fibonacci</option>
                    <option value="powers3">Powers of 3</option>
                    <option value="powers5">Powers of 5</option>
                    <option value="reverse">Reverse 2048</option>
                    <option value="merge3">Merge 3 Tiles</option>
                </select>
                <button id="new-game-btn" class="new-game-btn">New Game</button>
            </div>
        </div>
        
        <div class="game-main-content">
            <div class="game-board-container">
                <div class="game-board" id="game-board">
                    <!-- 游戏格子将通过JavaScript生成 -->
                </div>
            </div>
            
            <!-- 排行榜 -->
            <div class="leaderboard-container">
                <h3 class="leaderboard-title">🏆 Leaderboard</h3>
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" data-tab="global">Global</button>
                    <button class="tab-btn" data-tab="daily">Daily</button>
                </div>
                
                <div class="leaderboard-content">
                    <div class="tab-content active" id="global-tab">
                        <div class="leaderboard-list" id="global-leaderboard">
                            <!-- 排行榜数据将通过JavaScript生成 -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="friends-tab">
                        <div class="leaderboard-list" id="friends-leaderboard">
                            <!-- 好友排行榜数据 -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="daily-tab">
                        <div class="leaderboard-list" id="daily-leaderboard">
                            <!-- 每日排行榜数据 -->
                        </div>
                    </div>
                </div>
                
                <div class="leaderboard-actions">
                    <button id="refresh-leaderboard-btn" class="refresh-btn">Refresh</button>
                </div>
            </div>
        </div>
        
        <div class="game-message" id="game-message">
            <p></p>
            <div class="lower">
                <a class="retry-button">Try again</a>
            </div>
        </div>
    </div>

    <style>
        #game-container {
            background: #faf8f0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }
        
        .game-main-content {
            display: block;
            text-align: center;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        .game-board-container {
            display: inline-block;
            margin: 0 auto;
        }
        
        .leaderboard-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 380px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 0;
            z-index: 1000;
        }
        
        .leaderboard-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            color: #7a6a58;
            margin-bottom: 10px;
            margin-top: 0;
        }
        
        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .tab-btn {
            background: #f0f0f0;
            border: none;
            padding: 5px 10px;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: #8f7a66;
            color: white;
        }
        
        .tab-btn:hover:not(.active) {
            background: #e0e0e0;
        }
        
        .leaderboard-content {
            margin-bottom: 10px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .leaderboard-list {
            /* 移除高度限制和滚动条 */
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 6px;
            margin-bottom: 3px;
            background: #f8f6f0;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            transform: translateX(3px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-item.rank-1 {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 2px solid #ffb300;
        }
        
        .leaderboard-item.rank-2 {
            background: linear-gradient(135deg, #c0c0c0 0%, #e0e0e0 100%);
            border: 2px solid #a0a0a0;
        }
        
        .leaderboard-item.rank-3 {
            background: linear-gradient(135deg, #cd7f32 0%, #daa520 100%);
            border: 2px solid #b8860b;
        }
        
        .rank-number {
            font-size: 1rem;
            font-weight: bold;
            color: #7a6a58;
            min-width: 25px;
            text-align: center;
        }
        
        .rank-1 .rank-number {
            color: #b8860b;
        }
        
        .rank-2 .rank-number {
            color: #696969;
        }
        
        .rank-3 .rank-number {
            color: #8b4513;
        }
        
        .player-info {
            flex: 1;
            margin-left: 8px;
        }
        
        .player-name {
            font-size: 12px;
            font-weight: 600;
            color: #7a6a58;
            margin-bottom: 1px;
        }
        
        .player-score {
            font-size: 10px;
            color: #8f7a66;
            font-weight: 500;
        }
        
        .game-mode {
            font-size: 9px;
            color: #999;
            margin-top: 1px;
        }
        
        .score-value {
            font-size: 0.85rem;
            font-weight: bold;
            color: #7a6a58;
            margin-left: auto;
            padding-left: 8px;
        }
        
        .leaderboard-actions {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 6px;
        }
        
        .submit-score-btn, .refresh-btn, .clear-sample-btn {
            background: #8f7a66;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .submit-score-btn:hover, .refresh-btn:hover, .clear-sample-btn:hover {
            background: #7f6a56;
            transform: translateY(-2px);
        }
        
        .submit-score-btn:active, .refresh-btn:active, .clear-sample-btn:active {
            transform: translateY(0);
        }
        
        .clear-sample-btn {
            background: #e74c3c;
        }
        
        .clear-sample-btn:hover {
            background: #c0392b;
        }
        

        

        
        .empty-leaderboard {
            text-align: center;
            padding: 30px 15px;
            color: #999;
        }
        
        .empty-leaderboard .icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .empty-leaderboard h4 {
            margin: 0 0 8px 0;
            color: #7a6a58;
            font-size: 1rem;
        }
        
        .empty-leaderboard p {
            margin: 0;
            font-size: 12px;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
        }
        
        .score-container {
            display: flex;
            gap: 10px;
        }
        
        .score-box {
            background: #bbada0;
            padding: 10px 20px;
            border-radius: 6px;
            color: white;
            text-align: center;
            min-width: 80px;
        }
        
        .score-label {
            display: block;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .score-box span:last-child {
            font-size: 20px;
            font-weight: bold;
        }
        
        .new-game-btn {
            background: #8f7a66;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .new-game-btn:hover {
            background: #7f6a56;
        }
        
        .game-mode-selector {
            background: #8f7a66;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            transition: background 0.2s;
        }
        
        .game-mode-selector:hover {
            background: #7f6a56;
        }
        
        .game-mode-selector option {
            background: #8f7a66;
            color: white;
        }
        
        .game-board-container {
            position: relative;
            background: #bbada0;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 15px;
            width: 400px;
            height: 400px;
        }
        
        .grid-cell {
            background: #cdc1b4;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            font-weight: bold;
            color: #776e65;
            transition: all 0.15s ease;
            min-width: 80px;
            min-height: 80px;
        }
        
        .grid-cell.tile-2 { background: #eee4da; }
        .grid-cell.tile-4 { background: #ede0c8; }
        .grid-cell.tile-8 { background: #f2b179; color: #f9f6f2; }
        .grid-cell.tile-16 { background: #f59563; color: #f9f6f2; }
        .grid-cell.tile-32 { background: #f67c5f; color: #f9f6f2; }
        .grid-cell.tile-64 { background: #f65e3b; color: #f9f6f2; }
        .grid-cell.tile-128 { background: #edcf72; color: #f9f6f2; font-size: 30px; }
        .grid-cell.tile-256 { background: #edcc61; color: #f9f6f2; font-size: 30px; }
        .grid-cell.tile-512 { background: #edc850; color: #f9f6f2; font-size: 30px; }
        .grid-cell.tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 25px; }
        .grid-cell.tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 25px; }
        
        .game-message {
            display: none;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(238, 228, 218, 0.73);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            animation: fade-in 800ms ease;
        }
        
        .game-message.game-over {
            display: flex;
        }
        
        .game-message.game-won {
            display: flex;
        }
        
        .game-message p {
            font-size: 60px;
            font-weight: bold;
            margin: 0;
            margin-bottom: 20px;
            color: #776e65;
        }
        
        .retry-button {
            background: #8f7a66;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        @keyframes fade-in {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @media (max-width: 600px) {
            .game-board {
                width: 300px;
                height: 300px;
                gap: 10px;
            }
            
            .grid-cell {
                font-size: 25px;
            }
            
            .game-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .leaderboard-container {
                position: fixed;
                top: 10px;
                right: 10px;
                left: 10px;
                width: auto;
            }
            
            .leaderboard-tabs {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .tab-btn {
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .leaderboard-item {
                padding: 10px;
            }
            
            .player-name {
                font-size: 14px;
            }
            
            .score-value {
                font-size: 1rem;
            }
            
            .leaderboard-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .submit-score-btn, .refresh-btn, .clear-sample-btn {
                width: 100%;
                max-width: 200px;
            }
        }
        
        @media (max-width: 1000px) {
            .leaderboard-container {
                position: fixed;
                top: 15px;
                right: 15px;
                width: 300px;
            }
        }
    </style>

    <script>
        // 防爬虫保护系统
        class AntiCrawler {
            constructor() {
                this.requestCount = 0;
                this.lastRequestTime = Date.now();
                this.blockedIPs = new Set();
                this.suspiciousPatterns = [
                    'bot', 'crawler', 'spider', 'scraper', 'scraping',
                    'curl', 'wget', 'python', 'requests', 'urllib',
                    'selenium', 'phantomjs', 'headless', 'automation'
                ];
                this.init();
            }

            init() {
                this.detectBot();
                this.setupRateLimiting();
                this.addSecurityHeaders();
                this.monitorUserBehavior();
                this.protectGameLogic();
            }

            detectBot() {
                // 检测用户代理
                const userAgent = navigator.userAgent.toLowerCase();
                const isBot = this.suspiciousPatterns.some(pattern => 
                    userAgent.includes(pattern)
                );

                // 检测屏幕分辨率（机器人通常没有真实的屏幕）
                const screenWidth = screen.width;
                const screenHeight = screen.height;
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                // 检测鼠标移动（机器人通常没有真实的鼠标移动）
                let mouseMovements = 0;
                let lastMouseTime = Date.now();
                
                document.addEventListener('mousemove', () => {
                    mouseMovements++;
                    lastMouseTime = Date.now();
                });

                // 检测触摸事件（移动设备）
                let touchEvents = 0;
                document.addEventListener('touchstart', () => {
                    touchEvents++;
                });

                // 检测键盘事件
                let keyEvents = 0;
                document.addEventListener('keydown', () => {
                    keyEvents++;
                });

                // 延迟检测，给真实用户时间进行交互
                setTimeout(() => {
                    const timeSinceLastMouse = Date.now() - lastMouseTime;
                    const isSuspicious = (
                        isBot || 
                        (mouseMovements < 1 && keyEvents < 1 && timeSinceLastMouse > 20000) ||
                        (screenWidth === 0 || screenHeight === 0) ||
                        (viewportWidth === 0 || viewportHeight === 0)
                    );

                    if (isSuspicious) {
                        console.warn('Suspicious activity detected');
                        this.blockAccess();
                    }
                }, 10000); // 增加到10秒，给用户更多时间
            }

            setupRateLimiting() {
                // 限制请求频率
                const originalFetch = window.fetch;
                window.fetch = (...args) => {
                    const now = Date.now();
                    if (now - this.lastRequestTime < 100) { // 100ms内只能有一个请求
                        this.requestCount++;
                        if (this.requestCount > 10) {
                            this.blockAccess();
                            return Promise.reject(new Error('Rate limit exceeded'));
                        }
                    } else {
                        this.requestCount = 0;
                        this.lastRequestTime = now;
                    }
                    return originalFetch(...args);
                };

                // 限制XHR请求
                const originalXHROpen = XMLHttpRequest.prototype.open;
                XMLHttpRequest.prototype.open = function(...args) {
                    const now = Date.now();
                    if (now - this.lastRequestTime < 100) {
                        this.requestCount++;
                        if (this.requestCount > 10) {
                            this.blockAccess();
                            throw new Error('Rate limit exceeded');
                        }
                    } else {
                        this.requestCount = 0;
                        this.lastRequestTime = now;
                    }
                    return originalXHROpen.apply(this, args);
                };
            }

            addSecurityHeaders() {
                // 添加安全相关的meta标签
                const securityMeta = document.createElement('meta');
                securityMeta.httpEquiv = 'X-Content-Type-Options';
                securityMeta.content = 'nosniff';
                document.head.appendChild(securityMeta);

                const referrerMeta = document.createElement('meta');
                referrerMeta.name = 'referrer';
                referrerMeta.content = 'strict-origin-when-cross-origin';
                document.head.appendChild(referrerMeta);
            }

            monitorUserBehavior() {
                // 监控用户行为模式
                let keyPresses = 0;
                let clicks = 0;
                let scrolls = 0;
                let lastActivity = Date.now();

                // 键盘事件
                document.addEventListener('keydown', () => {
                    keyPresses++;
                    lastActivity = Date.now();
                });

                // 点击事件
                document.addEventListener('click', () => {
                    clicks++;
                    lastActivity = Date.now();
                });

                // 滚动事件
                document.addEventListener('scroll', () => {
                    scrolls++;
                    lastActivity = Date.now();
                });

                // 定期检查用户行为
                setInterval(() => {
                    const timeSinceLastActivity = Date.now() - lastActivity;
                    const isInactive = timeSinceLastActivity > 30000; // 30秒无活动
                    const hasMinimalActivity = keyPresses < 2 && clicks < 2 && scrolls < 2;

                    if (isInactive || hasMinimalActivity) {
                        console.warn('Suspicious user behavior detected');
                    }
                }, 10000);
            }

            protectGameLogic() {
                // 保护游戏逻辑不被外部访问
                const gameInstance = window.gameInstance;
                if (gameInstance) {
                    Object.freeze(gameInstance);
                    Object.defineProperty(window, 'gameInstance', {
                        get: () => gameInstance,
                        set: () => {
                            console.warn('Attempt to modify game instance blocked');
                            return false;
                        },
                        configurable: false
                    });
                }

                // 防止控制台访问游戏对象
                const originalConsoleLog = console.log;
                console.log = (...args) => {
                    if (args.some(arg => 
                        typeof arg === 'object' && 
                        arg !== null && 
                        (arg.grid || arg.score !== undefined)
                    )) {
                        console.warn('Game state access attempt blocked');
                        return;
                    }
                    originalConsoleLog.apply(console, args);
                };
            }

            blockAccess() {
                // 阻止访问
                document.body.innerHTML = `
                    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
                        <h1 style="color: #e74c3c;">Access Denied</h1>
                        <p>This website is protected against automated access.</p>
                        <p>Please contact support if you believe this is an error.</p>
                    </div>
                `;
                
                // 禁用所有事件监听器
                document.removeEventListener('keydown', null);
                document.removeEventListener('click', null);
                document.removeEventListener('scroll', null);
                
                // 阻止进一步的JavaScript执行
                throw new Error('Access blocked by anti-crawler protection');
            }
        }

        // 初始化防爬虫保护
        const antiCrawler = new AntiCrawler();

        // 额外的防爬虫保护
        (function() {
            'use strict';
            
            // 蜜罐陷阱 - 隐藏的链接和内容
            const honeypot = document.createElement('div');
            honeypot.style.cssText = 'position:absolute;left:-9999px;top:-9999px;visibility:hidden;';
            honeypot.innerHTML = `
                <a href="/admin">Admin Panel</a>
                <a href="/login">Login</a>
                <a href="/api/users">User API</a>
                <a href="/database">Database</a>
                <a href="/config">Configuration</a>
                <a href="/backup">Backup Files</a>
                <a href="/logs">Log Files</a>
                <a href="/phpinfo">PHP Info</a>
                <a href="/wp-admin">WordPress Admin</a>
                <a href="/cpanel">cPanel</a>
                <a href="/ftp">FTP Access</a>
                <a href="/ssh">SSH Access</a>
                <a href="/telnet">Telnet</a>
                <a href="/shell">Shell Access</a>
                <a href="/root">Root Directory</a>
                <a href="/etc">System Files</a>
                <a href="/var">Variable Files</a>
                <a href="/tmp">Temporary Files</a>
                <a href="/cache">Cache Files</a>
                <a href="/temp">Temp Files</a>
            `;
            document.body.appendChild(honeypot);
            
            // 监控蜜罐点击
            honeypot.addEventListener('click', function(e) {
                e.preventDefault();
                antiCrawler.blockAccess();
                return false;
            });
            
            // 检测开发者工具
            let devtools = {open: false, orientation: null};
            setInterval(() => {
                const threshold = 160;
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                
                if (widthThreshold || heightThreshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.warn('Developer tools detected');
                        antiCrawler.blockAccess();
                    }
                }
            }, 1000);
            
            // 检测控制台打开
            let consoleOpen = false;
            const checkConsole = () => {
                const start = performance.now();
                console.log('%c', 'color: transparent');
                const end = performance.now();
                if (end - start > 100) {
                    if (!consoleOpen) {
                        consoleOpen = true;
                        console.warn('Console access detected');
                        antiCrawler.blockAccess();
                    }
                }
            };
            setInterval(checkConsole, 1000);
            
            // 检测右键菜单
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                antiCrawler.blockAccess();
                return false;
            });
            
            // 检测键盘快捷键
            document.addEventListener('keydown', function(e) {
                // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                    (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                    antiCrawler.blockAccess();
                    return false;
                }
            });
            
            // 检测iframe嵌入
            if (window.self !== window.top) {
                antiCrawler.blockAccess();
            }
            
            // 检测无头浏览器
            if (!window.chrome || !window.chrome.webstore) {
                if (navigator.webdriver || navigator.userAgent.includes('Headless')) {
                    antiCrawler.blockAccess();
                }
            }
            
            // 检测自动化工具
            if (navigator.webdriver || 
                window.callPhantom || 
                window._phantom || 
                window.phantom || 
                window.__nightmare || 
                window.navigator.webdriver) {
                antiCrawler.blockAccess();
            }
            
        })();

        // 游戏相关功能
        function showGame(idx) {
            // 游戏切换功能
        }

        function toggleMenu() {
            var menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        }
        document.addEventListener('click', function(e) {
            var menu = document.getElementById('dropdownMenu');
            var icon = document.querySelector('.menu-icon');
            if (!menu.contains(e.target) && !icon.contains(e.target)) {
                menu.classList.remove('show');
            }
        });

        // Dropdown menu logic
        const menuIcon = document.getElementById('menuIcon');
        const dropdownMenu = document.getElementById('dropdownMenu');
        menuIcon.addEventListener('click', function(e) {
          e.preventDefault();
          dropdownMenu.classList.toggle('show');
        });
        document.addEventListener('click', function(e) {
          if (!dropdownMenu.contains(e.target) && e.target !== menuIcon) {
            dropdownMenu.classList.remove('show');
          }
        });

        // 2048游戏逻辑
        class Game2048 {
            constructor() {
                this.currentMode = 'classic';
                this.grid = Array(4).fill().map(() => Array(4).fill(0));
                this.score = 0;
                this.bestScore = localStorage.getItem('bestScore') || 0;
                this.gameOver = false;
                this.gameWon = false;
                this.init();
            }

            init() {
                this.createBoard();
                this.addRandomTile();
                this.addRandomTile();
                this.updateDisplay();
                this.setupEventListeners();
            }

            setupEventListeners() {
                // 键盘事件
                document.addEventListener('keydown', (e) => {
                    if (this.gameOver) return;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            e.preventDefault();
                            this.move('up');
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            this.move('down');
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.move('left');
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            this.move('right');
                            break;
                    }
                });

                // 触摸事件
                let startX, startY;
                document.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                });

                document.addEventListener('touchend', (e) => {
                    if (this.gameOver) return;
                    
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    const diffX = startX - endX;
                    const diffY = startY - endY;
                    
                    if (Math.abs(diffX) > Math.abs(diffY)) {
                        if (diffX > 0) this.move('left');
                        else this.move('right');
                    } else {
                        if (diffY > 0) this.move('up');
                        else this.move('down');
                    }
                });

                // 新游戏按钮
                document.getElementById('new-game-btn').addEventListener('click', () => {
                    this.newGame();
                });

                // 重试按钮
                document.querySelector('.retry-button').addEventListener('click', () => {
                    this.newGame();
                });

                // 游戏模式选择器
                document.getElementById('game-mode-selector').addEventListener('change', (e) => {
                    this.changeGameMode(e.target.value);
                });
            }

            move(direction) {
                let moved = false;
                
                switch(direction) {
                    case 'up':
                        moved = this.moveUp();
                        break;
                    case 'down':
                        moved = this.moveDown();
                        break;
                    case 'left':
                        moved = this.moveLeft();
                        break;
                    case 'right':
                        moved = this.moveRight();
                        break;
                }
                
                if (moved) {
                    this.addRandomTile();
                    this.updateDisplay();
                    this.checkGameState();
                }
            }

            getGameConfig(mode) {
                const configs = {
                    'classic': { size: 4, target: 2048, mergeRule: 'classic', sequence: [2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048] },
                    '3x3': { size: 3, target: 512, mergeRule: 'classic', sequence: [2, 4, 8, 16, 32, 64, 128, 256, 512] },
                    '5x5': { size: 5, target: 4096, mergeRule: 'classic', sequence: [2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096] },
                    'fibonacci': { size: 4, target: 2584, mergeRule: 'fibonacci', sequence: [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584] },
                    'powers3': { size: 4, target: 2187, mergeRule: 'powers3', sequence: [1, 3, 9, 27, 81, 243, 729, 2187] },
                    'powers5': { size: 4, target: 3125, mergeRule: 'powers5', sequence: [1, 5, 25, 125, 625, 3125] },
                    'reverse': { size: 4, target: 2, mergeRule: 'reverse', sequence: [2048, 1024, 512, 256, 128, 64, 32, 16, 8, 4, 2] },
                    'merge3': { size: 4, target: 2048, mergeRule: 'merge3', sequence: [2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048] }
                };
                return configs[mode] || configs['classic'];
            }

            canMerge(a, b, mergeRule) {
                switch(mergeRule) {
                    case 'fibonacci':
                        // 斐波那契数列：相邻两个数可以合并
                        const fib = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584];
                        const aIndex = fib.indexOf(a);
                        const bIndex = fib.indexOf(b);
                        return aIndex >= 0 && bIndex >= 0 && Math.abs(aIndex - bIndex) === 1;
                    case 'powers3':
                        // 3的幂次：相同数可以合并
                        return a === b;
                    case 'powers5':
                        // 5的幂次：相同数可以合并
                        return a === b;
                    case 'reverse':
                        // 反向：大数可以合并成小数
                        return a === b;
                    case 'merge3':
                        // 合并3个相同数
                        return a === b;
                    default:
                        // 经典：相同数可以合并
                        return a === b;
                }
            }

            getMergeResult(a, b, mergeRule) {
                switch(mergeRule) {
                    case 'fibonacci':
                        // 斐波那契数列的下一个数
                        const fib = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584];
                        const maxIndex = Math.max(fib.indexOf(a), fib.indexOf(b));
                        return fib[maxIndex + 1] || fib[maxIndex];
                    case 'reverse':
                        // 反向：大数合并成小数
                        return Math.min(a, b) / 2;
                    case 'merge3':
                        // 合并3个相同数
                        return a * 2;
                    default:
                        // 经典和其他：相同数合并
                        return a + b;
                }
            }

            updateDisplay() {
                // 更新分数
                document.getElementById('score').textContent = this.score;
                document.getElementById('best-score').textContent = this.bestScore;
                
                // 更新格子
                const config = this.getGameConfig(this.currentMode);
                for (let i = 0; i < config.size; i++) {
                    for (let j = 0; j < config.size; j++) {
                        const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                        if (cell) {
                            const value = this.grid[i][j];
                            
                            cell.className = 'grid-cell';
                            if (value > 0) {
                                cell.textContent = value;
                                cell.classList.add(`tile-${value}`);
                            } else {
                                cell.textContent = '';
                            }
                        }
                    }
                }
            }

            moveLeft() {
                const config = this.getGameConfig(this.currentMode);
                let moved = false;
                
                for (let i = 0; i < config.size; i++) {
                    const row = this.grid[i].filter(x => x !== 0);
                    let newRow = [];
                    
                    if (config.mergeRule === 'merge3') {
                        // 合并3个相同数的逻辑
                        for (let j = 0; j < row.length; j++) {
                            if (j < row.length - 2 && row[j] === row[j + 1] && row[j] === row[j + 2]) {
                                newRow.push(this.getMergeResult(row[j], row[j + 1], config.mergeRule));
                                this.score += newRow[newRow.length - 1];
                                j += 2;
                            } else {
                                newRow.push(row[j]);
                            }
                        }
                    } else {
                        // 经典合并逻辑
                        for (let j = 0; j < row.length - 1; j++) {
                            if (this.canMerge(row[j], row[j + 1], config.mergeRule)) {
                                newRow.push(this.getMergeResult(row[j], row[j + 1], config.mergeRule));
                                this.score += newRow[newRow.length - 1];
                                j++;
                            } else {
                                newRow.push(row[j]);
                            }
                        }
                        if (row.length > 0 && newRow.length < row.length) {
                            newRow.push(row[row.length - 1]);
                        }
                    }
                    
                    const finalRow = newRow.concat(Array(config.size - newRow.length).fill(0));
                    if (JSON.stringify(this.grid[i]) !== JSON.stringify(finalRow)) {
                        moved = true;
                    }
                    this.grid[i] = finalRow;
                }
                return moved;
            }

            moveRight() {
                const config = this.getGameConfig(this.currentMode);
                let moved = false;
                
                for (let i = 0; i < config.size; i++) {
                    const row = this.grid[i].filter(x => x !== 0);
                    let newRow = [];
                    
                    if (config.mergeRule === 'merge3') {
                        // 从右到左合并3个相同数
                        for (let j = row.length - 1; j >= 0; j--) {
                            if (j >= 2 && row[j] === row[j - 1] && row[j] === row[j - 2]) {
                                newRow.unshift(this.getMergeResult(row[j], row[j - 1], config.mergeRule));
                                this.score += newRow[0];
                                j -= 2;
                            } else {
                                newRow.unshift(row[j]);
                            }
                        }
                    } else {
                        // 经典合并逻辑
                        for (let j = row.length - 1; j > 0; j--) {
                            if (this.canMerge(row[j], row[j - 1], config.mergeRule)) {
                                newRow.unshift(this.getMergeResult(row[j], row[j - 1], config.mergeRule));
                                this.score += newRow[0];
                                j--;
                            } else {
                                newRow.unshift(row[j]);
                            }
                        }
                        if (row.length > 0 && newRow.length < row.length) {
                            newRow.unshift(row[0]);
                        }
                    }
                    
                    const finalRow = Array(config.size - newRow.length).fill(0).concat(newRow);
                    if (JSON.stringify(this.grid[i]) !== JSON.stringify(finalRow)) {
                        moved = true;
                    }
                    this.grid[i] = finalRow;
                }
                return moved;
            }

            moveUp() {
                const config = this.getGameConfig(this.currentMode);
                let moved = false;
                
                for (let j = 0; j < config.size; j++) {
                    let col = [];
                    for (let i = 0; i < config.size; i++) {
                        if (this.grid[i][j] !== 0) col.push(this.grid[i][j]);
                    }
                    
                    let newCol = [];
                    if (config.mergeRule === 'merge3') {
                        // 合并3个相同数
                        for (let i = 0; i < col.length; i++) {
                            if (i < col.length - 2 && col[i] === col[i + 1] && col[i] === col[i + 2]) {
                                newCol.push(this.getMergeResult(col[i], col[i + 1], config.mergeRule));
                                this.score += newCol[newCol.length - 1];
                                i += 2;
                            } else {
                                newCol.push(col[i]);
                            }
                        }
                    } else {
                        // 经典合并逻辑
                        for (let i = 0; i < col.length - 1; i++) {
                            if (this.canMerge(col[i], col[i + 1], config.mergeRule)) {
                                newCol.push(this.getMergeResult(col[i], col[i + 1], config.mergeRule));
                                this.score += newCol[newCol.length - 1];
                                i++;
                            } else {
                                newCol.push(col[i]);
                            }
                        }
                        if (col.length > 0 && newCol.length < col.length) {
                            newCol.push(col[col.length - 1]);
                        }
                    }
                    
                    const finalCol = newCol.concat(Array(config.size - newCol.length).fill(0));
                    for (let i = 0; i < config.size; i++) {
                        if (this.grid[i][j] !== finalCol[i]) {
                            moved = true;
                        }
                        this.grid[i][j] = finalCol[i];
                    }
                }
                return moved;
            }

            moveDown() {
                const config = this.getGameConfig(this.currentMode);
                let moved = false;
                
                for (let j = 0; j < config.size; j++) {
                    let col = [];
                    for (let i = 0; i < config.size; i++) {
                        if (this.grid[i][j] !== 0) col.push(this.grid[i][j]);
                    }
                    
                    let newCol = [];
                    if (config.mergeRule === 'merge3') {
                        // 从下到上合并3个相同数
                        for (let i = col.length - 1; i >= 0; i--) {
                            if (i >= 2 && col[i] === col[i - 1] && col[i] === col[i - 2]) {
                                newCol.unshift(this.getMergeResult(col[i], col[i - 1], config.mergeRule));
                                this.score += newCol[0];
                                i -= 2;
                            } else {
                                newCol.unshift(col[i]);
                            }
                        }
                    } else {
                        // 经典合并逻辑
                        for (let i = col.length - 1; i > 0; i--) {
                            if (this.canMerge(col[i], col[i - 1], config.mergeRule)) {
                                newCol.unshift(this.getMergeResult(col[i], col[i - 1], config.mergeRule));
                                this.score += newCol[0];
                                i--;
                            } else {
                                newCol.unshift(col[i]);
                            }
                        }
                        if (col.length > 0 && newCol.length < col.length) {
                            newCol.unshift(col[0]);
                        }
                    }
                    
                    const finalCol = Array(config.size - newCol.length).fill(0).concat(newCol);
                    for (let i = 0; i < config.size; i++) {
                        if (this.grid[i][j] !== finalCol[i]) {
                            moved = true;
                        }
                        this.grid[i][j] = finalCol[i];
                    }
                }
                return moved;
            }

            createBoard() {
                const gameBoard = document.getElementById('game-board');
                const config = this.getGameConfig(this.currentMode);
                gameBoard.innerHTML = '';
                
                // 设置网格大小
                gameBoard.style.gridTemplateColumns = `repeat(${config.size}, 1fr)`;
                gameBoard.style.gridTemplateRows = `repeat(${config.size}, 1fr)`;
                gameBoard.style.width = `${config.size * 100 + (config.size - 1) * 15}px`;
                gameBoard.style.height = `${config.size * 100 + (config.size - 1) * 15}px`;
                
                // 创建网格
                this.grid = Array(config.size).fill().map(() => Array(config.size).fill(0));
                
                for (let i = 0; i < config.size; i++) {
                    for (let j = 0; j < config.size; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell';
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        gameBoard.appendChild(cell);
                    }
                }
            }

            addRandomTile() {
                const config = this.getGameConfig(this.currentMode);
                const emptyCells = [];
                for (let i = 0; i < config.size; i++) {
                    for (let j = 0; j < config.size; j++) {
                        if (this.grid[i][j] === 0) {
                            emptyCells.push({row: i, col: j});
                        }
                    }
                }
                
                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    let value;
                    
                    switch(config.mergeRule) {
                        case 'fibonacci':
                            value = Math.random() < 0.8 ? 1 : 1;
                            break;
                        case 'powers3':
                            value = Math.random() < 0.8 ? 1 : 3;
                            break;
                        case 'powers5':
                            value = Math.random() < 0.8 ? 1 : 5;
                            break;
                        case 'reverse':
                            value = Math.random() < 0.8 ? 2048 : 1024;
                            break;
                        case 'merge3':
                            value = Math.random() < 0.8 ? 2 : 4;
                            break;
                        default:
                            value = Math.random() < 0.9 ? 2 : 4;
                    }
                    
                    this.grid[randomCell.row][randomCell.col] = value;
                }
            }

            checkGameState() {
                const config = this.getGameConfig(this.currentMode);
                
                // 检查是否获胜
                for (let i = 0; i < config.size; i++) {
                    for (let j = 0; j < config.size; j++) {
                        if (this.grid[i][j] === config.target && !this.gameWon) {
                            this.gameWon = true;
                            this.showMessage('You win!', 'game-won');
                        }
                    }
                }

                // 检查是否游戏结束
                if (this.isGameOver()) {
                    this.gameOver = true;
                    this.showMessage('Game Over!', 'game-over');
                    
                    // 游戏结束时自动检查分数是否可以进入排行榜
                    setTimeout(() => {
                        this.checkScoreForLeaderboard();
                    }, 1000); // 延迟1秒，让用户看到游戏结束消息
                }

                // 更新最高分
                if (this.score > this.bestScore) {
                    this.bestScore = this.score;
                    localStorage.setItem('bestScore', this.bestScore);
                }
            }

            isGameOver() {
                const config = this.getGameConfig(this.currentMode);
                
                // 检查是否有空格
                for (let i = 0; i < config.size; i++) {
                    for (let j = 0; j < config.size; j++) {
                        if (this.grid[i][j] === 0) return false;
                    }
                }

                // 检查是否可以合并
                for (let i = 0; i < config.size; i++) {
                    for (let j = 0; j < config.size; j++) {
                        const current = this.grid[i][j];
                        if ((i < config.size - 1 && this.canMerge(current, this.grid[i + 1][j], config.mergeRule)) ||
                            (j < config.size - 1 && this.canMerge(current, this.grid[i][j + 1], config.mergeRule))) {
                            return false;
                        }
                    }
                }
                return true;
            }

            showMessage(text, className) {
                const message = document.getElementById('game-message');
                message.querySelector('p').textContent = text;
                message.className = `game-message ${className}`;
            }

            newGame() {
                this.grid = Array(this.getGameConfig(this.currentMode).size).fill().map(() => Array(this.getGameConfig(this.currentMode).size).fill(0));
                this.score = 0;
                this.gameOver = false;
                this.gameWon = false;
                document.getElementById('game-message').className = 'game-message';
                this.createBoard();
                this.addRandomTile();
                this.addRandomTile();
                this.updateDisplay();
            }

            changeGameMode(mode) {
                this.currentMode = mode;
                this.newGame();
            }

            checkScoreForLeaderboard() {
                // 检查分数是否可以进入排行榜
                const shouldEnterLeaderboard = this.checkIfScoreQualifies(this.score);
                
                if (shouldEnterLeaderboard) {
                    // 显示输入姓名提示，防止输入网址
                    let playerName = '';
                    let isValidName = false;
                    
                    while (!isValidName) {
                        playerName = prompt('🎉 Congratulations! Your score qualifies for the leaderboard!\n\nEnter your name (max 10 characters, no URLs allowed):') || 'Anonymous';
                        
                        if (playerName === null) {
                            // 用户取消输入
                            return;
                        }
                        
                        // 检查是否包含网址
                        if (isValidPlayerName(playerName)) {
                            isValidName = true;
                        } else {
                            alert('❌ Invalid name! Please enter a real name without URLs or special characters.');
                        }
                    }
                    
                    const trimmedName = playerName.trim().substring(0, 10);

                    // 创建分数记录
                    const scoreRecord = {
                        rank: 0,
                        name: trimmedName,
                        score: this.score,
                        gameMode: getGameModeDisplayName(this.currentMode),
                        date: new Date().toLocaleDateString()
                    };

                    // 保存到本地存储
                    saveScoreToLeaderboard(scoreRecord);

                    // 刷新排行榜显示
                    const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab || 'global';
                    loadLeaderboardData(activeTab);

                    alert(`🎊 Amazing! You're now on the leaderboard!\nPlayer: ${trimmedName}\nScore: ${this.score.toLocaleString()}\nGame Mode: ${scoreRecord.gameMode}`);
                }
            }

            checkIfScoreQualifies(score) {
                const globalLeaderboard = JSON.parse(localStorage.getItem('leaderboard_global')) || [];
                
                if (globalLeaderboard.length < 10) {
                    return true; // 排行榜未满时，任何分数都可以进入
                }
                
                // 检查是否超过第10名的分数
                const lowestScore = globalLeaderboard[globalLeaderboard.length - 1].score;
                return score > lowestScore;
            }
        }

        // 初始化游戏
        let gameInstance;
        document.addEventListener('DOMContentLoaded', () => {
            try {
                gameInstance = new Game2048();
            } catch (error) {
                console.error('Error initializing game:', error);
            }
            
            // 初始化排行榜
            initLeaderboard();
        });
        
        // 排行榜功能
        function initLeaderboard() {
            // 标签页切换
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // 更新按钮状态
                    tabBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // 更新内容显示
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${targetTab}-tab`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // 加载对应排行榜数据
                    loadLeaderboardData(targetTab);
                });
            });

            // 添加按钮事件监听器
            const submitScoreBtn = document.getElementById('submit-score-btn');
            const refreshBtn = document.getElementById('refresh-leaderboard-btn');
            const clearSampleBtn = document.getElementById('clear-sample-btn');

            if (submitScoreBtn) {
                submitScoreBtn.addEventListener('click', checkAndUpdateLeaderboard);
            }

            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
                    loadLeaderboardData(activeTab);
                });
            }

            if (clearSampleBtn) {
                clearSampleBtn.addEventListener('click', clearSampleData);
            }
            

            

            
            // 初始化加载全球排行榜
            loadLeaderboardData('global');
        }
        
        function loadLeaderboardData(type) {
            const leaderboardElement = document.getElementById(`${type}-leaderboard`);
            
            // 从本地存储获取数据
            let leaderboardData = JSON.parse(localStorage.getItem(`leaderboard_${type}`)) || [];
            
            // 只在第一次加载且没有真实数据时生成示例数据
            if (leaderboardData.length === 0 && !localStorage.getItem(`sample_data_generated_${type}`)) {
                // 生成示例数据
                leaderboardData = generateSampleData(type);
                localStorage.setItem(`leaderboard_${type}`, JSON.stringify(leaderboardData));
                localStorage.setItem(`sample_data_generated_${type}`, 'true');
            }
            
            // 按分数排序
            leaderboardData.sort((a, b) => b.score - a.score);
            
            // 渲染排行榜
            renderLeaderboard(leaderboardElement, leaderboardData);
        }
        
        function generateSampleData(type) {
            const sampleData = [];
            
            // 更真实的游戏模式分布
            const gameModes = {
                'classic': 'Classic 2048',
                '3x3': '3x3 Grid', 
                '5x5': '5x5 Grid',
                'fibonacci': 'Fibonacci',
                'powers3': 'Powers of 3',
                'powers5': 'Powers of 5',
                'reverse': 'Reverse 2048',
                'merge3': 'Merge 3 Tiles'
            };
            
            // 更真实的玩家名称
            const playerNames = [
                'Alex', 'Sarah', 'Mike', 'Emma', 'David', 'Lisa', 'John', 'Anna', 'Tom', 'Sophie',
                'Chris', 'Maria', 'Ryan', 'Julia', 'Kevin', 'Rachel', 'Steve', 'Nina', 'Paul', 'Maya'
            ];
            
            // 根据排行榜类型生成不同的数据
            if (type === 'global') {
                // 全球排行榜 - 高分玩家
                const highScores = [
                    { name: 'Alex', score: 15680, mode: 'classic', daysAgo: 2 },
                    { name: 'Sarah', score: 14230, mode: '5x5', daysAgo: 1 },
                    { name: 'Mike', score: 13890, mode: 'fibonacci', daysAgo: 3 },
                    { name: 'Emma', score: 12560, mode: '3x3', daysAgo: 5 },
                    { name: 'David', score: 11870, mode: 'powers3', daysAgo: 1 },
                    { name: 'Lisa', score: 11240, mode: 'reverse', daysAgo: 4 },
                    { name: 'John', score: 10890, mode: 'merge3', daysAgo: 2 },
                    { name: 'Anna', score: 10230, mode: 'classic', daysAgo: 6 },
                    { name: 'Tom', score: 9870, mode: '5x5', daysAgo: 3 },
                    { name: 'Sophie', score: 9450, mode: 'fibonacci', daysAgo: 7 }
                ];
                
                highScores.forEach((player, index) => {
                    sampleData.push({
                        rank: index + 1,
                        name: player.name,
                        score: player.score,
                        gameMode: gameModes[player.mode],
                        date: new Date(Date.now() - player.daysAgo * 24 * 60 * 60 * 1000).toLocaleDateString()
                    });
                });
                
            } else if (type === 'daily') {
                // 每日排行榜 - 今天的活跃玩家
                const dailyScores = [
                    { name: 'Chris', score: 8920, mode: 'classic' },
                    { name: 'Maria', score: 8450, mode: '3x3' },
                    { name: 'Ryan', score: 7980, mode: '5x5' },
                    { name: 'Julia', score: 7560, mode: 'fibonacci' },
                    { name: 'Kevin', score: 7230, mode: 'powers3' },
                    { name: 'Rachel', score: 6890, mode: 'reverse' },
                    { name: 'Steve', score: 6540, mode: 'merge3' },
                    { name: 'Nina', score: 6210, mode: 'classic' }
                ];
                
                dailyScores.forEach((player, index) => {
                    sampleData.push({
                        rank: index + 1,
                        name: player.name,
                        score: player.score,
                        gameMode: gameModes[player.mode],
                        date: new Date().toLocaleDateString()
                    });
                });
                
            } else if (type === 'friends') {
                // 好友排行榜 - 朋友间的竞争
                const friendsScores = [
                    { name: 'Alex', score: 13450, mode: 'classic', daysAgo: 1 },
                    { name: 'Sarah', score: 12890, mode: '5x5', daysAgo: 2 },
                    { name: 'Mike', score: 12120, mode: 'fibonacci', daysAgo: 1 },
                    { name: 'Emma', score: 11560, mode: '3x3', daysAgo: 3 },
                    { name: 'David', score: 10980, mode: 'powers3', daysAgo: 2 },
                    { name: 'Lisa', score: 10340, mode: 'reverse', daysAgo: 1 },
                    { name: 'John', score: 9870, mode: 'merge3', daysAgo: 4 }
                ];
                
                friendsScores.forEach((player, index) => {
                    sampleData.push({
                        rank: index + 1,
                        name: player.name,
                        score: player.score,
                        gameMode: gameModes[player.mode],
                        date: new Date(Date.now() - player.daysAgo * 24 * 60 * 60 * 1000).toLocaleDateString()
                    });
                });
            }
            
            return sampleData;
        }
        
        function renderLeaderboard(container, data) {
            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-leaderboard">
                        <div class="icon">🏆</div>
                        <h4>No ranking data</h4>
                        <p>Be the first player to submit a score!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = data.map((player, index) => {
                const rankClass = index < 3 ? `rank-${index + 1}` : '';
                const medal = index < 3 ? ['🥇', '🥈', '🥉'][index] : '';
                
                return `
                    <div class="leaderboard-item ${rankClass}">
                        <div class="rank-number">${medal || (index + 1)}</div>
                        <div class="player-info">
                            <div class="player-name">${player.name}</div>
                            <div class="player-score">${player.gameMode}</div>
                            <div class="game-mode">${player.date}</div>
                        </div>
                        <div class="score-value">${player.score.toLocaleString()}</div>
                    </div>
                `;
            }).join('');
        }
        

        
        function checkAndUpdateLeaderboard() {
    if (gameInstance) {
        // 使用游戏实例的方法自动检查分数
        gameInstance.checkScoreForLeaderboard();
    } else {
        alert('Game not initialized yet. Please wait a moment and try again.');
    }
}
        

        
        function getMinimumScoreForLeaderboard() {
            const globalLeaderboard = JSON.parse(localStorage.getItem('leaderboard_global')) || [];
            
            if (globalLeaderboard.length === 0) {
                return 1000; // 默认最低分数
            }
            
            if (globalLeaderboard.length < 10) {
                return 1000; // 排行榜未满时
            }
            
            // 返回第10名的分数
            return globalLeaderboard[globalLeaderboard.length - 1].score;
        }

        function isValidPlayerName(name) {
            if (!name || name.trim().length === 0) return false;
            
            // 检查是否包含网址模式
            const urlPatterns = [
                /https?:\/\//i,           // http:// 或 https://
                /www\./i,                  // www.
                /\.com/i,                  // .com
                /\.org/i,                  // .org
                /\.net/i,                  // .net
                /\.cn/i,                   // .cn
                /\.qq\.com/i,              // .qq.com
                /\.baidu\.com/i,           // .baidu.com
                /\.google\.com/i,          // .google.com
                /\.github\.com/i,          // .github.com
                /[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/i,  // 通用域名模式
                /[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,  // IP地址
                /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/i  // 邮箱地址
            ];
            
            // 检查是否包含特殊字符（只允许字母、数字、中文、空格、连字符、下划线）
            const validNamePattern = /^[a-zA-Z\u4e00-\u9fa5\s\-_0-9]+$/;
            
            // 检查长度
            if (name.trim().length > 20) return false;
            
            // 检查是否包含网址模式
            for (const pattern of urlPatterns) {
                if (pattern.test(name)) {
                    return false;
                }
            }
            
            // 检查是否只包含有效字符
            if (!validNamePattern.test(name)) {
                return false;
            }
            
            return true;
        }
        
        function getGameModeDisplayName(mode) {
            const modeNames = {
                'classic': 'Classic 2048',
                '3x3': '3x3 Grid',
                '5x5': '5x5 Grid',
                'fibonacci': 'Fibonacci',
                'powers3': 'Powers of 3',
                'powers5': 'Powers of 5',
                'reverse': 'Reverse 2048',
                'merge3': 'Merge 3 Tiles'
            };
            return modeNames[mode] || mode;
        }
        
        function clearSampleData() {
            // 清除所有示例数据
            localStorage.removeItem('leaderboard_global');
            localStorage.removeItem('leaderboard_daily');
            localStorage.removeItem('leaderboard_friends');
            localStorage.removeItem('sample_data_generated_global');
            localStorage.removeItem('sample_data_generated_daily');
            localStorage.removeItem('sample_data_generated_friends');
            localStorage.removeItem('real_data_started');
            
            // 刷新当前显示的排行榜
            const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
            loadLeaderboardData(activeTab);
            
            alert('Sample data cleared successfully! Leaderboards are now empty and ready for real scores.');
        }
        
        function saveScoreToLeaderboard(scoreRecord) {
            // 当用户提交第一个真实分数时，清除示例数据
            if (!localStorage.getItem('real_data_started')) {
                localStorage.setItem('real_data_started', 'true');
                // 清除所有示例数据标记
                localStorage.removeItem('sample_data_generated_global');
                localStorage.removeItem('sample_data_generated_daily');
                localStorage.removeItem('sample_data_generated_friends');
            }
            
            // Save to global leaderboard (top 10 only)
            let globalLeaderboard = JSON.parse(localStorage.getItem('leaderboard_global')) || [];
            globalLeaderboard.push(scoreRecord);
            globalLeaderboard.sort((a, b) => b.score - a.score);
            globalLeaderboard = globalLeaderboard.slice(0, 10); // Keep top 10 only
            localStorage.setItem('leaderboard_global', JSON.stringify(globalLeaderboard));
            
            // Save to daily leaderboard
            const today = new Date().toDateString();
            let dailyLeaderboard = JSON.parse(localStorage.getItem('leaderboard_daily')) || [];
            
            // Remove old daily data
            dailyLeaderboard = dailyLeaderboard.filter(record => {
                const recordDate = new Date(record.date).toDateString();
                return recordDate === today;
            });
            
            dailyLeaderboard.push(scoreRecord);
            dailyLeaderboard.sort((a, b) => b.score - a.score);
            dailyLeaderboard = dailyLeaderboard.slice(0, 10); // Keep top 10 only
            localStorage.setItem('leaderboard_daily', JSON.stringify(dailyLeaderboard));
            
            // Save to friends leaderboard (using local storage simulation)
            let friendsLeaderboard = JSON.parse(localStorage.getItem('leaderboard_friends')) || [];
            friendsLeaderboard.push(scoreRecord);
            friendsLeaderboard.sort((a, b) => b.score - a.score);
            friendsLeaderboard = friendsLeaderboard.slice(0, 10); // Keep top 10 only
            localStorage.setItem('leaderboard_friends', JSON.stringify(friendsLeaderboard));
        }
    </script>
    <!-- SEO Content Section -->
    <section style="background: #fff; padding: 40px 20px; margin-top: 20px;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h2 style="color: #7a6a58; text-align: center; font-size: 2rem; margin-bottom: 30px;">2468 Game - Free Number Puzzle Games</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px;">
                <div style="background: #f8f6f0; padding: 25px; border-radius: 12px;">
                    <h3 style="color: #7a6a58; font-size: 1.5rem; margin-bottom: 15px;">🎮 How to Play 2468</h3>
                    <p style="color: #4a4e69; line-height: 1.6;">Use your arrow keys or swipe on mobile to move tiles. When two tiles with the same number touch, they merge into one! Try to reach the 2468 tile to win. Plan your moves strategically and keep your highest tile in a corner for best results.</p>
                </div>
                
                <div style="background: #f8f6f0; padding: 25px; border-radius: 12px;">
                    <h3 style="color: #7a6a58; font-size: 1.5rem; margin-bottom: 15px;">🧠 Brain Training Benefits</h3>
                    <p style="color: #4a4e69; line-height: 1.6;">2468 is more than just a game - it's a brain training exercise that improves logical thinking, strategic planning, and mathematical skills. Perfect for students, professionals, and anyone who wants to keep their mind sharp.</p>
                </div>
                
                <div style="background: #f8f6f0; padding: 25px; border-radius: 12px;">
                    <h3 style="color: #7a6a58; font-size: 1.5rem; margin-bottom: 15px;">📱 Play Anywhere</h3>
                    <p style="color: #4a4e69; line-height: 1.6;">Our 2468 game works perfectly on all devices - desktop, tablet, and mobile. No downloads required, just open your browser and start playing. Save your progress automatically and challenge your friends to beat your score!</p>
                </div>
            </div>
            
            <div style="background: #f0f8ff; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                <h3 style="color: #7a6a58; font-size: 1.8rem; margin-bottom: 20px; text-align: center;">🎯 Why Choose 2468 Game Online?</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                        <h4 style="color: #7a6a58; font-size: 1.2rem; margin-bottom: 10px;">✨ Free to Play</h4>
                        <p style="color: #4a4e69;">No registration, no downloads, no hidden costs. Enjoy unlimited gameplay completely free!</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="color: #7a6a58; font-size: 1.2rem; margin-bottom: 10px;">🚀 Multiple Game Modes</h4>
                        <p style="color: #4a4e69;">Try 8 different game variants: Classic 2048, 3x3 Grid, 5x5 Grid, Fibonacci, Powers of 3/5, Reverse 2048, and Merge 3 Tiles!</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="color: #7a6a58; font-size: 1.2rem; margin-bottom: 10px;">🧩 Smart AI & Controls</h4>
                        <p style="color: #4a4e69;">Optimized for all devices with responsive design, touch controls, and intuitive keyboard navigation.</p>
                    </div>
                </div>
            </div>
            
            <div style="background: #fff5f5; padding: 25px; border-radius: 12px;">
                <h3 style="color: #7a6a58; font-size: 1.5rem; margin-bottom: 15px;">🎮 Game Features</h3>
                <ul style="color: #4a4e69; line-height: 1.8; padding-left: 20px;">
                    <li><strong>8 Game Modes:</strong> Classic 2048, 3x3 Grid, 5x5 Grid, Fibonacci, Powers of 3/5, Reverse 2048, and Merge 3 Tiles</li>
                    <li><strong>Smart Controls:</strong> Use arrow keys on desktop or swipe gestures on mobile</li>
                    <li><strong>Score Tracking:</strong> Keep track of your best scores and challenge yourself to improve</li>
                    <li><strong>Leaderboard System:</strong> Compete with players worldwide with global, daily, and friends rankings</li>
                    <li><strong>Responsive Design:</strong> Perfect gameplay experience on any screen size</li>
                    <li><strong>No Registration:</strong> Start playing immediately without any sign-up required</li>
                    <li><strong>Local Storage:</strong> Your best scores are automatically saved in your browser</li>
                    <li><strong>Multiple Challenges:</strong> Each game mode offers unique rules and strategies</li>
                </ul>
            </div>
        </div>
    </section>
    
    <footer style="text-align: center; padding: 20px; color: #7a6a58; background: #faf8f0;">
        <p>Play the best 2468 and 2048 number puzzle games online. Challenge your brain with 2468, a fun twist on the classic 2048 game.</p>
        <p style="margin-top: 10px; font-size: 0.9rem;">© 2025 2468 Game Online - Free Number Puzzle Games</p>
    </footer>

    <!-- 分数提交模态框 -->
    <div id="score-modal" class="score-modal" style="display: none;">
        <div class="score-modal-content">
            <h3>Submit Score</h3>
            <div class="score-info">
                <p>Current Score: <span id="modal-score">0</span></p>
                <p>Game Mode: <span id="modal-mode">Classic 2048</span></p>
            </div>
            <div class="name-input">
                <label for="player-name-input">Enter your name (max 10 characters):</label>
                <input type="text" id="player-name-input" maxlength="10" placeholder="Your name">
            </div>
            <div class="modal-actions">
                <button id="submit-score-confirm" class="submit-btn">Submit</button>
                <button id="cancel-score-submit" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>
</body>
</html>